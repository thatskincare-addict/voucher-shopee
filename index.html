<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CÃ´ng cá»¥ chuyá»ƒn Ä‘á»•i</title>
    <style>
        :root {
            --accent: #5c8b9f; --bg-cream: #f8f5e6; --text-dark: #4a3f35;
            --text-light: #7a6f65; --notice-bg: #fffbf0; --warning-yellow: #fff9c4;
            --error-red: #f8d7da; --error-text: #721c24; --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-cream); color: var(--text-dark); margin: 0; padding: 60px 15px; padding-bottom: 100px; }
        .container { background: #fff; border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); width: 100%; max-width: 500px; margin: auto; overflow: hidden; border: 2px solid #e8e4d5; padding-bottom: 30px; }
        .banner { width: 100%; height: 140px; background: var(--accent); }
        .logo-wrapper { width: 80px; height: 80px; background: white; border-radius: 50%; margin: -40px auto 15px auto; padding: 5px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border: 2px solid var(--bg-cream); }
        .logo-wrapper img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
        .content { padding: 0 25px; }
        h2 { text-align: center; margin: 0; font-size: 20px; font-weight: 800; }
        .subtitle { text-align: center; color: var(--text-light); font-size: 13px; margin: 8px 0 20px 0; }
        
        /* BULK SECTION UPGRADED */
        .bulk-section { background: #f0f4f5; padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px dashed var(--accent); }
        textarea { width: 100%; height: 80px; border-radius: 10px; border: 1px solid #ddd; padding: 10px; font-size: 12px; resize: none; box-sizing: border-box; font-family: inherit; margin-bottom: 8px; }
        .bulk-btn-row { display: flex; gap: 8px; flex-wrap: wrap; }
        .btn-bulk-main { background: var(--accent); color: white; border: none; padding: 10px; border-radius: 8px; font-weight: bold; flex: 2; cursor: pointer; font-size: 11px; }
        .btn-bulk-sec { background: var(--text-dark); color: white; border: none; padding: 10px; border-radius: 8px; font-weight: bold; flex: 1; cursor: pointer; font-size: 11px; }
        .btn-bulk-del { background: #e8e4d5; color: var(--text-dark); border: none; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 11px; }

        .input-row-wrapper { margin-bottom: 12px; }
        .input-row { display: flex; align-items: center; gap: 10px; }
        .input-num { font-weight: 800; color: var(--accent); width: 20px; text-align: right; }
        input { flex: 1; padding: 14px; border: 2px solid #e8e4d5; border-radius: 12px; transition: var(--transition); background: var(--bg-cream); color: var(--text-dark); }
        input:focus { border-color: var(--accent); outline: none; background: #fff; box-shadow: 0 0 0 4px rgba(92, 139, 159, 0.1); }
        input.warning-link { background-color: var(--warning-yellow); border-color: #ffeeba; }
        input.error-link { background-color: var(--error-red); border-color: #f5c6cb; }
        
        .status-bar { display: none; font-size: 11px; padding: 10px; border-radius: 10px; margin-top: 6px; margin-left: 30px; border: 1px solid transparent; align-items: center; justify-content: space-between; }
        .warning-bar { background: #fff3cd; color: #856404; border-color: #ffeeba; }
        .error-bar { background: #f8d7da; color: var(--error-text); border-color: #f5c6cb; }
        
        .subid-section { margin: 20px 0; padding: 15px; background: #f0f4f5; border-radius: 15px; border: 1px solid #e0e8ea; }
        .subid-label { font-size: 11px; font-weight: 800; color: var(--accent); text-transform: uppercase; margin-bottom: 8px; display: block; }
        .flex-row { display: flex; gap: 10px; }
        .btn-group-main { display: flex; gap: 10px; margin-top: 10px; }
        
        .primary-btn { flex: 2; padding: 16px; background: var(--accent); color: white; border-radius: 12px; font-weight: bold; font-size: 16px; border:none; cursor:pointer;}
        .clear-btn { flex: 1; padding: 16px; background: #e8e4d5; border-radius: 12px; font-weight: bold; border:none; cursor:pointer;}
        
        .result-card { background: var(--bg-cream); padding: 15px; border-radius: 15px; margin-top: 15px; border: 2px solid #e8e4d5; }
        .btn-purchase {
            background: linear-gradient(135deg, #5c8b9f 0%, #4a7a96 100%);
            color: white; flex: 2; padding: 12px 20px; border-radius: 12px; font-size: 14px; font-weight: 800;
            text-decoration: none; text-align: center; text-transform: uppercase; letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(92, 139, 159, 0.3); transition: var(--transition);
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }
        .btn-purchase:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(92, 139, 159, 0.4); filter: brightness(1.1); }

        .admin-box { background: #eee; padding: 10px; border-radius: 12px; margin-top: 20px; border: 1px solid #ddd; }
        .admin-btn-group { display: none; flex-direction: column; gap: 10px; margin-top: 10px; }
        .winner-btn { background: #f39c12; color: white; padding: 12px; border-radius: 10px; font-weight: bold; border:none; cursor:pointer; }
        .winner-result { margin-top: 15px; padding: 15px; background: #fff3cd; border: 2px dashed #f39c12; border-radius: 12px; text-align: center; }
        .sheet-btn { background: #1a73e8; color: white; padding: 12px; border-radius: 10px; text-decoration: none; text-align: center; font-weight: bold; font-size: 14px; }
        .export-btn { background: #28a745; color: white; padding: 12px; border-radius: 10px; font-weight: bold; border:none; cursor:pointer;}
        .fan-group-btn { display: flex; align-items: center; justify-content: center; gap: 10px; background: var(--text-dark); color: white; padding: 14px; border-radius: 15px; text-decoration: none; font-weight: bold; font-size: 14px; margin: 20px 0; transition: var(--transition); }
        .notice-board { background: var(--notice-bg); border: 2px solid #e8e4d5; border-radius: 20px; padding: 20px; position: relative; text-align: center; margin-top: 25px; }
        .notice-board::before { content: 'ğŸ“Œ'; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); font-size: 20px; }

        #socialProof {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(150%);
            background: white; padding: 12px 20px; border-radius: 50px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 10px;
            z-index: 9999; border: 2px solid var(--accent); transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            min-width: 280px; font-size: 12px; font-weight: 600;
        }
        #socialProof.show { transform: translateX(-50%) translateY(0); }
        .proof-dot { width: 8px; height: 8px; background: #28a745; border-radius: 50%; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.5); opacity: 0.5; } 100% { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

<div id="socialProof">
    <div class="proof-dot"></div>
    <span id="proofText">Äang táº£i hoáº¡t Ä‘á»™ng má»›i...</span>
</div>

<div class="container">
    <div class="banner"></div>
    <div class="logo-wrapper"><img src="https://i.pinimg.com/736x/06/3c/fa/063cfa3125f4cb7a29fda76242998113.jpg"></div>
    <div class="content">
        <h2>ğŸ›ï¸ Chuyá»ƒn Ä‘á»•i link Shopee - nháº­n mÃ£ giáº£m giÃ¡</h2>
        <p class="subtitle">DÃ¡n danh sÃ¡ch link hoáº·c dÃ¡n tá»«ng Ã´ Ä‘á»ƒ chuyá»ƒn Ä‘á»•i ^0^</p>

        <div class="bulk-section">
            <label class="subid-label">ğŸš€ DÃ¡n danh sÃ¡ch link hÃ ng loáº¡t</label>
            <textarea id="bulkInput" placeholder="DÃ¡n danh sÃ¡ch link Shopee vÃ o Ä‘Ã¢y (má»—i link 1 dÃ²ng)..."></textarea>
            <div class="bulk-btn-row">
                <button class="btn-bulk-main" onclick="handleBulkPaste()">Äiá»n vÃ o 5 Ã´ bÃªn dÆ°á»›i âœ¨</button>
                <button class="btn-bulk-sec" onclick="bulkPasteFromClipboard()">DÃ¡n Clipboard ğŸ“‹</button>
                <button class="btn-bulk-del" onclick="document.getElementById('bulkInput').value = ''">XÃ³a ğŸ—‘ï¸</button>
            </div>
        </div>

        <div id="inputs">
            <div class="input-row-wrapper"><div class="input-row"><span class="input-num">1</span><input type="text" class="link-input" placeholder="https://shopee.vn/â€¦" oninput="validateLink(this)"><button style="padding:10px; border-radius:10px; border:none;" onclick="pasteFromClipboard(this)">DÃ¡n ğŸ“‹</button></div><div class="status-bar warning-bar"><span>âš ï¸ Link sai Ä‘á»‹nh dáº¡ng!</span><button style="background:var(--accent); color:white; border:none; padding:5px; border-radius:5px;" onclick="autoFix(this)">Fix âœ¨</button></div><div class="status-bar error-bar"><span>âŒ KhÃ´ng pháº£i Shopee</span></div></div>
            <div class="input-row-wrapper"><div class="input-row"><span class="input-num">2</span><input type="text" class="link-input" placeholder="https://shopee.vn/â€¦" oninput="validateLink(this)"><button style="padding:10px; border-radius:10px; border:none;" onclick="pasteFromClipboard(this)">DÃ¡n ğŸ“‹</button></div><div class="status-bar warning-bar"><span>âš ï¸ Link sai Ä‘á»‹nh dáº¡ng!</span><button style="background:var(--accent); color:white; border:none; padding:5px; border-radius:5px;" onclick="autoFix(this)">Fix âœ¨</button></div><div class="status-bar error-bar"><span>âŒ KhÃ´ng pháº£i Shopee</span></div></div>
            <div class="input-row-wrapper"><div class="input-row"><span class="input-num">3</span><input type="text" class="link-input" placeholder="https://shopee.vn/â€¦" oninput="validateLink(this)"><button style="padding:10px; border-radius:10px; border:none;" onclick="pasteFromClipboard(this)">DÃ¡n ğŸ“‹</button></div><div class="status-bar warning-bar"><span>âš ï¸ Link sai Ä‘á»‹nh dáº¡ng!</span><button style="background:var(--accent); color:white; border:none; padding:5px; border-radius:5px;" onclick="autoFix(this)">Fix âœ¨</button></div><div class="status-bar error-bar"><span>âŒ KhÃ´ng pháº£i Shopee</span></div></div>
            <div class="input-row-wrapper"><div class="input-row"><span class="input-num">4</span><input type="text" class="link-input" placeholder="https://shopee.vn/â€¦" oninput="validateLink(this)"><button style="padding:10px; border-radius:10px; border:none;" onclick="pasteFromClipboard(this)">DÃ¡n ğŸ“‹</button></div><div class="status-bar warning-bar"><span>âš ï¸ Link sai Ä‘á»‹nh dáº¡ng!</span><button style="background:var(--accent); color:white; border:none; padding:5px; border-radius:5px;" onclick="autoFix(this)">Fix âœ¨</button></div><div class="status-bar error-bar"><span>âŒ KhÃ´ng pháº£i Shopee</span></div></div>
            <div class="input-row-wrapper"><div class="input-row"><span class="input-num">5</span><input type="text" class="link-input" placeholder="https://shopee.vn/â€¦" oninput="validateLink(this)"><button style="padding:10px; border-radius:10px; border:none;" onclick="pasteFromClipboard(this)">DÃ¡n ğŸ“‹</button></div><div class="status-bar warning-bar"><span>âš ï¸ Link sai Ä‘á»‹nh dáº¡ng!</span><button style="background:var(--accent); color:white; border:none; padding:5px; border-radius:5px;" onclick="autoFix(this)">Fix âœ¨</button></div><div class="status-bar error-bar"><span>âŒ KhÃ´ng pháº£i Shopee</span></div></div>
        </div>

        <div class="subid-section">
            <label class="subid-label">ğŸ Tham gia Minigame (khÃ´ng báº¯t buá»™c)</label>
            <div class="flex-row">
                <input type="text" id="subIdInput" placeholder="4 sá»‘ cuá»‘i SÄT" oninput="validateSubId(this)">
                <input type="text" id="igInput" placeholder="Instagram username" style="background: white;">
            </div>
        </div>
        <div class="btn-group-main">
            <button class="clear-btn" onclick="clearAll()">XÃ³a háº¿t</button>
            <button id="mainBtn" class="primary-btn" onclick="generate()">Chuyá»ƒn Ä‘á»•i</button>
        </div>
        <div id="results-section" style="display:none; margin-top:20px;"></div>
        
        <div class="admin-box">
            <div id="adminLock">
                <span style="font-size: 10px; font-weight: bold;">ğŸ”’ ADMIN PIN</span>
                <div style="display:flex; gap:5px; margin-top:5px;"><input type="password" id="adminPass" style="padding:8px;"><button onclick="unlockAdmin()" style="padding:8px; border-radius:8px; border:none; background:var(--text-dark); color:white;">Má»Ÿ</button></div>
            </div>
            <div class="admin-btn-group" id="adminButtons">
                <a href="https://docs.google.com/spreadsheets/d/15ixJKmdX7Msgzi8KRdJGpy0Dj7sR0481N8lTNUdEl3A/edit#gid=0" target="_blank" class="sheet-btn">ğŸ“Š Má»Ÿ Google Sheet Master</a>
                <button class="winner-btn" onclick="pickWinner()">ğŸ² Chá»n ngÆ°á»i trÃºng thÆ°á»Ÿng</button>
                <div id="winnerDisplay"></div>
                <button class="export-btn" onclick="exportToCSV()">ğŸ“¥ Xuáº¥t CSV (Backup)</button>
            </div>
        </div>

        <a href="https://www.instagram.com/channel/AbZaUamGAW15JNEI/" target="_blank" class="fan-group-btn">ğŸ’¬ Tham gia nhÃ³m bÃ¡o sale, deal</a>
        
        <div class="notice-board">
            <div style="font-weight:800; font-size:14px;">ğŸ“‹ Báº£ng tin voucher</div>
            <div style="font-size:11px; color:var(--accent); margin:5px 0 10px 0;">â° Ãp dá»¥ng: 1.2.2026 - 8.2.2026</div>
            <div style="font-size:13px; line-height:1.5; color:var(--text-light); text-align:middle;">
                ğŸ‘‰ğŸ» Giáº£m 25%, tá»‘i Ä‘a 250K, cho Ä‘Æ¡n tá»« 150K<br>
                ğŸ‘‰ğŸ» Giáº£m 22%, tá»‘i Ä‘a 200K, cho Ä‘Æ¡n tá»« 150K<br>
                ğŸ‘‰ğŸ» Giáº£m 20%, tá»‘i Ä‘a 100K, cho Ä‘Æ¡n tá»« 100K<br>
                ğŸ‘‰ğŸ» Giáº£m 18%, tá»‘i Ä‘a 100K, cho Ä‘Æ¡n tá»« 50K<br><br>
                â—ï¸ Duy nháº¥t 2.2: Giáº£m 30% max 300k Ä‘Æ¡n 50k
            </div>
        </div>
    </div>
</div>

<script>
    const AFF_ID = "17352430059", BASE = "https://s.shopee.vn/an_redir?origin_link=", ADMIN_PIN = "290703";
    const BRIDGE_URL = "https://script.google.com/macros/s/AKfycbwAq5mQMNuoCnC3-xbMSxJOOQ2J5EjHL9oi6Jn_JYlPOyLF8yDolZYLHG43CtdZVd30/exec";

    function unlockAdmin() {
        if (document.getElementById('adminPass').value === ADMIN_PIN) {
            document.getElementById('adminButtons').style.display = "flex";
            document.getElementById('adminLock').style.display = "none";
        } else { alert("Sai mÃ£ pin!"); }
    }

    const tickerMessages = [
        "Vá»«a cÃ³ báº¡n chuyá»ƒn Ä‘á»•i link thÃ nh cÃ´ng!",
        "Má»™t báº¡n vá»«a nháº­n voucher giáº£m giÃ¡ âœ¨",
        "CÃ³ ngÆ°á»i vá»«a tham gia minigame!",
        "Link Shopee vá»«a Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i sang mÃ£ giáº£m giÃ¡.",
        "Há»‡ thá»‘ng Ä‘ang xá»­ lÃ½ ráº¥t nhiá»u Ä‘Æ¡n hÃ ng bÃ¡o sale."
    ];

    function startSocialProof() {
        const proofEl = document.getElementById('socialProof');
        const textEl = document.getElementById('proofText');
        setInterval(() => {
            let msg = tickerMessages[Math.floor(Math.random() * tickerMessages.length)];
            let logs = JSON.parse(localStorage.getItem('minigame_logs') || "[]");
            if(logs.length > 0 && Math.random() > 0.6) {
                let randomLog = logs[Math.floor(Math.random() * logs.length)];
                msg = `Báº¡n @${randomLog.ig.substring(0,2)}*** vá»«a tham gia minigame!`;
            }
            textEl.innerText = msg; proofEl.classList.add('show');
            setTimeout(() => { proofEl.classList.remove('show'); }, 4000);
        }, 12000);
    }
    window.onload = startSocialProof;

    function handleBulkPaste() {
        const lines = document.getElementById('bulkInput').value.split(/\n/).map(l => l.trim()).filter(l => l.length > 0);
        const inputs = document.querySelectorAll('.link-input');
        lines.slice(0, 5).forEach((line, index) => {
            inputs[index].value = line;
            validateLink(inputs[index]);
        });
        if (lines.length > 5) alert("Chá»‰ há»— trá»£ tá»‘i Ä‘a 5 link Ä‘áº§u tiÃªn!");
    }

    async function bulkPasteFromClipboard() {
        try {
            const text = await navigator.clipboard.readText();
            document.getElementById('bulkInput').value = text;
        } catch (err) { alert("Cho phÃ©p truy cáº­p Clipboard!"); }
    }

    function validateSubId(input) { input.value = input.value.replace(/[^0-9]/g, '').slice(0, 4); }

    function validateLink(input) {
        const val = input.value.trim().toLowerCase();
        const wrapper = input.closest('.input-row-wrapper');
        const warn = wrapper.querySelector('.warning-bar'), err = wrapper.querySelector('.error-bar');
        input.classList.remove('warning-link', 'error-link');
        warn.style.display = err.style.display = "none";
        if (!val) return;
        if (!val.includes('shopee.vn') && !val.includes('shp.ee') && !val.includes('shope.ee')) { input.classList.add('error-link'); err.style.display = "flex"; }
        else if ((val.includes('shp.ee') || val.includes('shope.ee')) && !val.includes('shopee.vn')) { input.classList.add('warning-link'); warn.style.display = "flex"; }
    }

    async function generate() {
        const inputs = document.querySelectorAll('.link-input'), sub = document.getElementById('subIdInput').value.trim(), ig = document.getElementById('igInput').value.trim();
        const resSection = document.getElementById('results-section'), mainBtn = document.getElementById('mainBtn');

        if (ig && sub) {
            fetch(BRIDGE_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ instagram: ig, subid: sub }) });
            let logs = JSON.parse(localStorage.getItem('minigame_logs') || "[]");
            logs.unshift({ ig, phone: sub, time: new Date().toLocaleString('vi-VN') });
            localStorage.setItem('minigame_logs', JSON.stringify(logs.slice(0, 1000)));
        }

        mainBtn.innerText = "Chá» tÃ­..."; mainBtn.disabled = true;
        resSection.innerHTML = ""; let count = 0;
        for (let i = 0; i < inputs.length; i++) {
            const val = inputs[i].value.trim();
            if (val) {
                let long = BASE + encodeURIComponent(val) + "&affiliate_id=" + AFF_ID + (sub ? "&sub_id="+sub : "");
                const res = await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(long)}`);
                const final = res.ok ? await res.text() : long;
                resSection.innerHTML += `<div class="result-card"><div style="font-weight:800; font-size:11px; color:var(--accent);">LINK #${i+1}</div><div style="font-size:11px; word-break:break-all; margin:8px 0;">${final}</div><div style="display:flex; gap:10px;"><a href="${final}" target="_blank" class="btn-purchase">MUA NGAY ğŸ›’</a><button class="clear-btn" style="padding:10px; font-size:12px;" onclick="navigator.clipboard.writeText('${final}').then(()=>alert('ÄÃ£ copy!'))">Sao chÃ©p</button></div></div>`;
                count++;
            }
        }
        if(count > 0) resSection.style.display = "block";
        mainBtn.innerText = "Chuyá»ƒn Ä‘á»•i"; mainBtn.disabled = false;
    }

    function pickWinner() {
        const logs = JSON.parse(localStorage.getItem('minigame_logs') || "[]");
        if (logs.length === 0) return alert("ChÆ°a cÃ³ ai tham gia!");
        const winner = logs[Math.floor(Math.random() * logs.length)];
        document.getElementById('winnerDisplay').innerHTML = `<div class="winner-result"><div style="font-size:12px; font-weight:bold; color:#856404;">ğŸŠ NGÆ¯á»œI CHIáº¾N THáº®NG ğŸŠ</div><div style="font-size:18px; font-weight:900; margin:10px 0;">@${winner.ig}</div><div style="font-size:11px; color:var(--text-light);">SÄT: ****${winner.phone}</div></div>`;
    }

    function clearAll() { 
        document.querySelectorAll('.link-input').forEach(i => i.value = ""); 
        document.getElementById('bulkInput').value = "";
        document.getElementById('results-section').style.display = "none";
        document.querySelectorAll('.status-bar').forEach(s => s.style.display = "none");
    }

    async function autoFix(btn) {
        const input = btn.closest('.input-row-wrapper').querySelector('.link-input');
        const url = input.value.trim(); btn.innerText = "...";
        try {
            const res = await fetch(`https://unshorten.me/s/${url}`);
            const long = await res.text(); input.value = long.includes('shopee.vn') ? long.trim() : url;
            validateLink(input);
        } catch (e) { window.open(url, '_blank'); } finally { btn.innerText = "Fix âœ¨"; }
    }

    async function pasteFromClipboard(btn) {
        try {
            const text = await navigator.clipboard.readText();
            const input = btn.closest('.input-row').querySelector('.link-input');
            input.value = text; validateLink(input);
        } catch (err) { alert("Cho phÃ©p Clipboard!"); }
    }

    function exportToCSV() {
        const logs = JSON.parse(localStorage.getItem('minigame_logs') || "[]");
        if (!logs.length) return alert("Trá»‘ng!");
        let csv = "\uFEFFInstagram,Phone,Time\n";
        logs.forEach(r => csv += `${r.ig},${r.phone},${r.time}\n`);
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = `Data.csv`; a.click();
    }
</script>
</body>
</html>
