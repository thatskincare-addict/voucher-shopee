<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng c·ª• chuy·ªÉn ƒë·ªïi</title>
    <style>
        /* --- SNORLAX THEME PALETTE --- */
        :root {
            --accent: #5c8b9f; 
            --bg-cream: #f8f5e6;
            --text-dark: #4a3f35;
            --text-light: #7a6f65;
            --notice-bg: #fffbf0;
            --warning-yellow: #fff9c4;
            --error-red: #f8d7da;
            --error-text: #721c24;
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body { 
            font-family: 'Inter', -apple-system, sans-serif;
            background-color: var(--bg-cream);
            color: var(--text-dark);
            margin: 0; padding: 60px 15px;
            min-height: 100vh;
        }

        .container { 
            background: #ffffff; padding: 0 0 30px 0;
            border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            width: 100%; max-width: 500px; margin: auto;
            overflow: hidden; border: 2px solid #e8e4d5;
        }

        .banner { width: 100%; height: 140px; background: var(--accent); }
        .logo-wrapper {
            width: 80px; height: 80px; background: white; border-radius: 50%;
            margin: -40px auto 15px auto; padding: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); border: 2px solid var(--bg-cream);
        }
        .logo-wrapper img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }

        .content { padding: 0 25px; }
        h2 { text-align: center; margin: 0; font-size: 20px; font-weight: 800; }
        .subtitle { text-align: center; color: var(--text-light); font-size: 13px; margin: 8px 0 20px 0; }

        /* INPUT ROWS */
        .input-row-wrapper { margin-bottom: 12px; }
        .input-row { display: flex; align-items: center; gap: 10px; }
        .input-num { font-weight: 800; color: var(--accent); width: 20px; text-align: right; }
        
        input { 
            flex: 1; padding: 14px; border: 2px solid #e8e4d5; 
            border-radius: 12px; transition: var(--transition); background: var(--bg-cream);
            color: var(--text-dark);
        }
        input:focus { border-color: var(--accent); outline: none; background: #fff; box-shadow: 0 0 0 4px rgba(92, 139, 159, 0.1); }

        input.warning-link { background-color: var(--warning-yellow); border-color: #ffeeba; }
        input.error-link { background-color: var(--error-red); border-color: #f5c6cb; }

        /* STATUS BARS */
        .status-bar { 
            display: none; font-size: 11px; padding: 10px; border-radius: 10px; 
            margin-top: 6px; margin-left: 30px; border: 1px solid transparent;
            align-items: center; justify-content: space-between;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        
        .warning-bar { background: #fff3cd; color: #856404; border-color: #ffeeba; }
        .error-bar { background: #f8d7da; color: var(--error-text); border-color: #f5c6cb; }

        /* MULTI-INPUT SECTION */
        .subid-section { margin: 20px 0; padding: 15px; background: #f0f4f5; border-radius: 15px; border: 1px solid #e0e8ea; }
        .subid-label { font-size: 11px; font-weight: 800; color: var(--accent); text-transform: uppercase; margin-bottom: 8px; display: block; }
        .flex-row { display: flex; gap: 10px; }

        /* BUTTONS */
        button, .fan-btn, .btn-purchase {
            transition: var(--transition); cursor: pointer; border: none;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        button:active, .fan-btn:active, .btn-purchase:active { transform: scale(0.96); }

        .btn-paste { background: #e8e4d5; color: var(--text-dark); padding: 12px; border-radius: 12px; font-weight: bold; font-size: 13px; }
        .auto-fix-btn { background: var(--accent); color: white; padding: 6px 12px; border-radius: 8px; font-weight: bold; font-size: 10px; }

        .btn-group-main { display: flex; gap: 10px; margin-top: 10px; }
        .primary-btn { flex: 2; padding: 16px; background: var(--accent); color: white; border-radius: 12px; font-weight: bold; font-size: 16px; }
        .primary-btn:hover { background: #4a7a96; transform: translateY(-1px); }
        .clear-btn { flex: 1; padding: 16px; background: #e8e4d5; color: var(--text-dark); border-radius: 12px; font-weight: bold; }

        .result-card { background: var(--bg-cream); padding: 15px; border-radius: 15px; margin-bottom: 12px; border: 2px solid #e8e4d5; }
        .btn-row { display: flex; gap: 8px; margin-top: 10px; }
        .btn-copy { background: #e8e4d5; color: var(--text-dark); flex: 1; padding: 10px; border-radius: 8px; font-size: 12px; font-weight: bold; }
        .btn-purchase { background: var(--accent); color: white; flex: 1; padding: 10px; border-radius: 8px; font-size: 12px; font-weight: bold; text-decoration: none; }

        /* FOOTER & ADMIN */
        .history-toggle { width: 100%; padding: 10px; background: transparent; border: 1px dashed #ccc; border-radius: 10px; margin-top: 25px; font-size: 11px; color: var(--text-light); }
        .history-content { display: none; margin-top: 10px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .admin-box { background: #eee; padding: 10px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #ddd; }
        .admin-row { display: flex; gap: 5px; margin-top: 5px; }
        .admin-row input { padding: 8px; font-size: 12px; }
        .btn-unlock { background: var(--text-dark); color: white; padding: 8px 12px; border-radius: 8px; font-size: 11px; font-weight: bold; }
        .export-btn { background: #28a745; color: white; padding: 12px; border-radius: 12px; font-weight: bold; font-size: 14px; width: 100%; margin-bottom: 15px; display: none; }

        .fan-btn { display: flex; text-align: center; margin: 20px 0; padding: 14px; background: var(--text-dark); color: white; border-radius: 12px; text-decoration: none; font-weight: bold; }
        .notice-board { background: var(--notice-bg); border: 2px solid #e8e4d5; border-radius: 20px; padding: 20px; position: relative; text-align: center; }
        .notice-board::before { content: 'üìå'; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); font-size: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="banner"></div>
    <div class="logo-wrapper"><img src="https://i.pinimg.com/736x/06/3c/fa/063cfa3125f4cb7a29fda76242998113.jpg" alt="Logo"></div>

    <div class="content">
        <h2>üõçÔ∏è Chuy·ªÉn ƒë·ªïi link Shopee - nh·∫≠n m√£ gi·∫£m gi√°</h2>
        <p class="subtitle">M√£ t·ª± ƒë·ªông c√≥ trong m·ª•c √°p voucher khi mua qua link chuy·ªÉn ƒë·ªïi ^0^</p>

        <div id="inputs">
            <div class="input-row-wrapper">
                <div class="input-row"><span class="input-num">1</span><input type="text" class="link-input" placeholder="https://shopee.vn/‚Ä¶" oninput="validateLink(this)"><button class="btn-paste" onclick="pasteFromClipboard(this)">D√°n üìã</button></div>
                <div class="status-bar warning-bar"><span>‚ö†Ô∏è Link sai ƒë·ªãnh d·∫°ng!</span><button class="auto-fix-btn" onclick="autoFix(this)">Fix link ‚ú®</button></div>
                <div class="status-bar error-bar"><span>‚ùå L·ªói: Link kh√¥ng ph·∫£i Shopee.</span></div>
            </div>
            <div class="input-row-wrapper">
                <div class="input-row"><span class="input-num">2</span><input type="text" class="link-input" placeholder="https://shopee.vn/‚Ä¶" oninput="validateLink(this)"><button class="btn-paste" onclick="pasteFromClipboard(this)">D√°n üìã</button></div>
                <div class="status-bar warning-bar"><span>‚ö†Ô∏è Link sai ƒë·ªãnh d·∫°ng!</span><button class="auto-fix-btn" onclick="autoFix(this)">Fix link ‚ú®</button></div>
                <div class="status-bar error-bar"><span>‚ùå L·ªói: Link kh√¥ng ph·∫£i Shopee.</span></div>
            </div>
            <div class="input-row-wrapper">
                <div class="input-row"><span class="input-num">3</span><input type="text" class="link-input" placeholder="https://shopee.vn/‚Ä¶" oninput="validateLink(this)"><button class="btn-paste" onclick="pasteFromClipboard(this)">D√°n üìã</button></div>
                <div class="status-bar warning-bar"><span>‚ö†Ô∏è Link sai ƒë·ªãnh d·∫°ng!</span><button class="auto-fix-btn" onclick="autoFix(this)">Fix link ‚ú®</button></div>
                <div class="status-bar error-bar"><span>‚ùå L·ªói: Link kh√¥ng ph·∫£i Shopee.</span></div>
            </div>
            <div class="input-row-wrapper">
                <div class="input-row"><span class="input-num">4</span><input type="text" class="link-input" placeholder="https://shopee.vn/‚Ä¶" oninput="validateLink(this)"><button class="btn-paste" onclick="pasteFromClipboard(this)">D√°n üìã</button></div>
                <div class="status-bar warning-bar"><span>‚ö†Ô∏è Link sai ƒë·ªãnh d·∫°ng!</span><button class="auto-fix-btn" onclick="autoFix(this)">Fix link ‚ú®</button></div>
                <div class="status-bar error-bar"><span>‚ùå L·ªói: Link kh√¥ng ph·∫£i Shopee.</span></div>
            </div>
            <div class="input-row-wrapper">
                <div class="input-row"><span class="input-num">5</span><input type="text" class="link-input" placeholder="https://shopee.vn/‚Ä¶" oninput="validateLink(this)"><button class="btn-paste" onclick="pasteFromClipboard(this)">D√°n üìã</button></div>
                <div class="status-bar warning-bar"><span>‚ö†Ô∏è Link sai ƒë·ªãnh d·∫°ng!</span><button class="auto-fix-btn" onclick="autoFix(this)">Fix link ‚ú®</button></div>
                <div class="status-bar error-bar"><span>‚ùå L·ªói: Link kh√¥ng ph·∫£i Shopee.</span></div>
            </div>
        </div>

        <div class="subid-section">
            <label class="subid-label">üéÅ Tham gia Minigame (Kh√¥ng b·∫Øt bu·ªôc)</label>
            <div class="flex-row">
                <input type="text" id="subIdInput" placeholder="4 s·ªë cu·ªëi SƒêT" oninput="validateSubId(this)">
                <input type="text" id="igInput" placeholder="Instagram username" style="background: white;">
            </div>
        </div>

        <div class="btn-group-main">
            <button class="clear-btn" onclick="clearAll()">X√≥a h·∫øt</button>
            <button id="mainBtn" class="primary-btn" onclick="generate()">Chuy·ªÉn ƒë·ªïi</button>
        </div>

        <div id="results-section" style="display:none; margin-top:20px;">
            <div id="results"></div>
        </div>

        <button class="history-toggle" onclick="toggleHistory()">üìú Xem l·ªãch s·ª≠ chuy·ªÉn ƒë·ªïi</button>
        <div id="history-section" class="history-content">
            <div class="admin-box" id="adminBox">
                <span style="font-size: 10px; font-weight: bold; color: var(--text-light);">üîí X√ÅC MINH ADMIN</span>
                <div class="admin-row">
                    <input type="password" id="adminPass" placeholder="Nh·∫≠p m√£ pin">
                    <button class="btn-unlock" onclick="unlockAdmin()">M·ªü kh√≥a</button>
                </div>
            </div>
            <button id="exportBtn" class="export-btn" onclick="exportToCSV()">üì• Xu·∫•t danh s√°ch tham gia (Excel)</button>
            <div id="history-list"></div>
        </div>
        
        <a href="https://www.instagram.com/channel/AbZaUamGAW15JNEI/" target="_blank" class="fan-btn">üí¨ Tham gia nh√≥m b√°o sale, deal</a>

        <div class="notice-board">
            <div style="font-weight:800; font-size:14px;">üìã B·∫£ng tin voucher</div>
            <div style="font-size:11px; color:var(--accent); margin:5px 0 10px 0;">‚è∞ √Åp d·ª•ng: 1.2.2026 - 8.2.2026</div>
            <div style="font-size:13px; line-height:1.5; color:var(--text-light); text-align:middle;">
                üëâüèª Gi·∫£m 25%, t·ªëi ƒëa 250K, cho ƒë∆°n t·ª´ 150K<br>
                üëâüèª Gi·∫£m 22%, t·ªëi ƒëa 200K, cho ƒë∆°n t·ª´ 150K<br>
                üëâüèª Gi·∫£m 20%, t·ªëi ƒëa 100K, cho ƒë∆°n t·ª´ 100K<br>
                üëâüèª Gi·∫£m 18%, t·ªëi ƒëa 100K, cho ƒë∆°n t·ª´ 50K<br><br>
                ‚ùóÔ∏è Duy nh·∫•t h√¥m nay 02.02: Gi·∫£m 30% max 300k ƒë∆°n 50k
            </div>
        </div>
    </div>
</div>

<script>
    const AFF_ID = "17352430059";
    const BASE = "https://s.shopee.vn/an_redir?origin_link=";
    const ADMIN_PIN = "290703";

    window.onload = function() { loadHistory(); };

    function unlockAdmin() {
        const pin = document.getElementById('adminPass').value;
        if (pin === ADMIN_PIN) {
            document.getElementById('exportBtn').style.display = "block";
            document.getElementById('adminBox').style.display = "none";
            alert("ƒê√£ m·ªü kh√≥a quy·ªÅn qu·∫£n tr·ªã!");
        } else { alert("Sai m√£ pin r·ªìi!"); }
    }

    function validateSubId(input) {
        input.value = input.value.replace(/[^a-zA-Z0-9]/g, '');
    }

    function validateLink(input) {
        const val = input.value.trim().toLowerCase();
        const wrapper = input.closest('.input-row-wrapper');
        const warnBar = wrapper.querySelector('.warning-bar');
        const errorBar = wrapper.querySelector('.error-bar');
        input.classList.remove('warning-link', 'error-link');
        if(warnBar) warnBar.style.display = "none";
        if(errorBar) errorBar.style.display = "none";
        if (!val) return;
        const isShopee = val.includes('shopee.vn') || val.includes('shp.ee') || val.includes('shope.ee');
        const needsFix = (val.includes('shp.ee') || val.includes('shope.ee')) && !val.includes('shopee.vn');
        if (!isShopee) { input.classList.add('error-link'); if(errorBar) errorBar.style.display = "flex"; } 
        else if (needsFix) { input.classList.add('warning-link'); if(warnBar) warnBar.style.display = "flex"; }
    }

    async function autoFix(btn) {
        const wrapper = btn.closest('.input-row-wrapper');
        const input = wrapper.querySelector('.link-input');
        const originalUrl = input.value.trim();
        btn.innerText = "ƒêang fix..."; btn.disabled = true;
        try {
            const response = await fetch(`https://unshorten.me/s/${originalUrl}`);
            const longUrl = await response.text();
            if (longUrl && longUrl.includes('shopee.vn')) { input.value = longUrl.trim(); validateLink(input); } 
            else { window.open(originalUrl, '_blank'); }
        } catch (e) { window.open(originalUrl, '_blank'); } 
        finally { btn.innerText = "Fix link ‚ú®"; btn.disabled = false; }
    }

    async function pasteFromClipboard(btn) {
        try {
            const text = await navigator.clipboard.readText();
            const input = btn.closest('.input-row').querySelector('.link-input');
            input.value = text;
            validateLink(input);
        } catch (err) { alert("C·∫•p quy·ªÅn Clipboard ƒë·ªÉ d√°n!"); }
    }

    async function getShortLink(longUrl) {
        try {
            const response = await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(longUrl)}`);
            return response.ok ? await response.text() : longUrl;
        } catch (e) { return longUrl; }
    }

    async function generate() {
        const inputs = document.querySelectorAll('.link-input');
        const subIdValue = document.getElementById('subIdInput').value.trim();
        const igValue = document.getElementById('igInput').value.trim();
        const display = document.getElementById('results');
        const mainBtn = document.getElementById('mainBtn');
        
        if (igValue && subIdValue) {
            let logs = JSON.parse(localStorage.getItem('minigame_logs') || "[]");
            logs.unshift({ ig: igValue, phone: subIdValue, time: new Date().toLocaleString('vi-VN') });
            localStorage.setItem('minigame_logs', JSON.stringify(logs.slice(0, 1000)));
        }

        mainBtn.innerText = "ƒêang x·ª≠ l√Ω..."; mainBtn.disabled = true;
        display.innerHTML = "";
        let history = JSON.parse(localStorage.getItem('sh_hist') || "[]");

        for (let i = 0; i < inputs.length; i++) {
            const val = inputs[i].value.trim();
            if (val) {
                let longAff = BASE + encodeURIComponent(val) + "&affiliate_id=" + AFF_ID;
                if (subIdValue) longAff += "&sub_id=" + subIdValue;
                const final = await getShortLink(longAff);
                const card = document.createElement('div');
                card.className = 'result-card';
                card.innerHTML = `<div style="font-weight:800; font-size:11px; color:var(--accent);">LINK #${i+1}</div>
                    <div style="font-size:11px; word-break:break-all; margin:8px 0;">${final}</div>
                    <div class="btn-row"><a href="${final}" target="_blank" class="btn-purchase">Mua ngay</a><button class="btn-copy" onclick="copySingle('${final}')">Sao ch√©p</button></div>`;
                display.appendChild(card);
                history.unshift({ url: final, time: new Date().toLocaleTimeString('vi-VN') });
            }
        }
        document.getElementById('results-section').style.display = "block";
        localStorage.setItem('sh_hist', JSON.stringify(history.slice(0, 15)));
        mainBtn.innerText = "Chuy·ªÉn ƒë·ªïi"; mainBtn.disabled = false;
        loadHistory();
    }

    function exportToCSV() {
        const logs = JSON.parse(localStorage.getItem('minigame_logs') || "[]");
        if (!logs.length) { alert("Ch∆∞a c√≥ ai tham gia!"); return; }
        let csv = "\uFEFFInstagram,Phone (SubID),Thoi gian\n";
        logs.forEach(row => { csv += `${row.ig},${row.phone},${row.time}\n`; });
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.setAttribute("download", `Minigame_IG_${new Date().toLocaleDateString()}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function copySingle(txt) { navigator.clipboard.writeText(txt).then(() => alert("ƒê√£ sao ch√©p!")); }
    function clearAll() { 
        document.querySelectorAll('.link-input').forEach(i => i.value = ""); 
        document.querySelectorAll('.status-bar').forEach(s => s.style.display = "none");
        document.querySelectorAll('.link-input').forEach(i => i.classList.remove('warning-link', 'error-link'));
        document.getElementById('subIdInput').value = ""; 
        document.getElementById('igInput').value = "";
        document.getElementById('results-section').style.display="none"; 
    }
    function toggleHistory() { const s = document.getElementById('history-section'); s.style.display = s.style.display === "block" ? "none" : "block"; }
    function loadHistory() {
        const list = document.getElementById('history-list');
        const hist = JSON.parse(localStorage.getItem('sh_hist') || "[]");
        list.innerHTML = hist.length ? "" : "<p style='font-size:11px; text-align:center;'>Tr·ªëng</p>";
        hist.forEach(h => {
            const d = document.createElement('div'); d.className = 'result-card'; d.style.opacity = "0.75";
            d.innerHTML = `<div style="font-size:10px; font-weight:bold;">${h.time}</div><div style="font-size:10px; word-break:break-all;">${h.url}</div>`;
            list.appendChild(d);
        });
    }
</script>

</body>
</html>
