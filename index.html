<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CÃ´ng cá»¥ chuyá»ƒn Ä‘á»•i link</title>
    <style>
        /* --- SNORLAX THEME PALETTE --- */
        :root {
            --accent: #5c8b9f; 
            --bg-cream: #f8f5e6;
            --text-dark: #4a3f35;
            --text-light: #7a6f65;
            --notice-bg: #fffbf0;
            --warning-yellow: #fff9c4;
            --error-red: #f8d7da;
            --error-text: #721c24;
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body { 
            font-family: 'Inter', -apple-system, sans-serif;
            background-color: var(--bg-cream);
            color: var(--text-dark);
            margin: 0; padding: 60px 15px;
            min-height: 100vh;
        }

        .container { 
            background: #ffffff; padding: 0 0 30px 0;
            border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            width: 100%; max-width: 500px; margin: auto;
            overflow: hidden; border: 2px solid #e8e4d5;
        }

        .banner { width: 100%; height: 140px; background: var(--accent); }
        .logo-wrapper {
            width: 80px; height: 80px; background: white; border-radius: 50%;
            margin: -40px auto 15px auto; padding: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); border: 2px solid var(--bg-cream);
        }
        .logo-wrapper img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }

        .content { padding: 0 25px; }
        h2 { text-align: center; margin: 0; font-size: 20px; font-weight: 800; }
        .subtitle { text-align: center; color: var(--text-light); font-size: 13px; margin: 8px 0 20px 0; }

        .input-row-wrapper { margin-bottom: 12px; }
        .input-row { display: flex; align-items: center; gap: 10px; }
        .input-num { font-weight: 800; color: var(--accent); width: 20px; text-align: right; }
        
        input { 
            flex: 1; padding: 14px; border: 2px solid #e8e4d5; 
            border-radius: 12px; transition: var(--transition); background: var(--bg-cream);
            color: var(--text-dark);
        }
        input:focus { border-color: var(--accent); outline: none; background: #fff; box-shadow: 0 0 0 4px rgba(92, 139, 159, 0.1); }

        input.warning-link { background-color: var(--warning-yellow); border-color: #ffeeba; }
        input.error-link { background-color: var(--error-red); border-color: #f5c6cb; }

        .status-bar { 
            display: none; font-size: 11px; padding: 10px; border-radius: 10px; 
            margin-top: 6px; margin-left: 30px; border: 1px solid transparent;
            align-items: center; justify-content: space-between;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        
        .warning-bar { background: #fff3cd; color: #856404; border-color: #ffeeba; }
        .error-bar { background: #f8d7da; color: var(--error-text); border-color: #f5c6cb; }

        button, .fan-btn, .btn-purchase {
            transition: var(--transition);
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        button:active, .fan-btn:active, .btn-purchase:active { transform: scale(0.96); }

        /* PASTE BUTTON STYLING */
        .btn-paste {
            background: #e8e4d5;
            color: var(--text-dark);
            padding: 12px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 13px;
        }
        .btn-paste:hover { background: #d8d4c5; }

        .auto-fix-btn { 
            background: var(--accent); color: white;
            padding: 6px 12px; border-radius: 8px; 
            font-weight: bold; font-size: 10px; 
        }
        .auto-fix-btn:hover { background: #4a7a96; }
        .auto-fix-btn:disabled { opacity: 0.6; cursor: wait; }

        .btn-group-main { display: flex; gap: 10px; margin-top: 10px; }
        .primary-btn { flex: 2; padding: 16px; background: var(--accent); color: white; border-radius: 12px; font-weight: bold; font-size: 16px; }
        .primary-btn:hover { background: #4a7a96; box-shadow: 0 4px 15px rgba(92, 139, 159, 0.25); transform: translateY(-1px); }
        .primary-btn:disabled { background: var(--text-light); cursor: wait; }

        .clear-btn { flex: 1; padding: 16px; background: #e8e4d5; color: var(--text-dark); border-radius: 12px; font-weight: bold; }
        .clear-btn:hover { background: #d8d4c5; }

        .result-card { background: var(--bg-cream); padding: 15px; border-radius: 15px; margin-bottom: 12px; border: 2px solid #e8e4d5; animation: fadeIn 0.4s ease; }
        .copy-all-btn { width: 100%; padding: 14px; background: var(--text-dark); color: white; border-radius: 12px; margin-bottom: 15px; font-weight: bold; font-size: 14px; }
        .copy-all-btn:hover { background: #332b24; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transform: translateY(-1px); }
        
        .btn-row { display: flex; gap: 8px; margin-top: 10px; }
        .btn-copy { background: #e8e4d5; color: var(--text-dark); flex: 1; padding: 10px; border-radius: 8px; font-size: 12px; font-weight: bold; }
        .btn-copy:hover { background: #d8d4c5; }
        .btn-purchase { background: var(--accent); color: white; flex: 1; padding: 10px; border-radius: 8px; font-size: 12px; font-weight: bold; text-decoration: none; }
        .btn-purchase:hover { background: #4a7a96; }

        .history-toggle { width: 100%; padding: 10px; background: transparent; border: 1px dashed #ccc; border-radius: 10px; margin-top: 25px; font-size: 11px; color: var(--text-light); }
        .history-toggle:hover { background: #fff; border-color: var(--accent); color: var(--accent); }
        .history-content { display: none; margin-top: 10px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .fan-btn { display: flex; text-align: center; margin: 20px 0; padding: 14px; background: var(--text-dark); color: white; border-radius: 12px; text-decoration: none; font-weight: bold; }
        .fan-btn:hover { background: #332b24; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transform: translateY(-1px); }
        .notice-board { background: var(--notice-bg); border: 2px solid #e8e4d5; border-radius: 20px; padding: 20px; position: relative; text-align: center; }
        .notice-board::before { content: 'ğŸ“Œ'; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); font-size: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="banner"></div>
    <div class="logo-wrapper"><img src="https://i.pinimg.com/736x/06/3c/fa/063cfa3125f4cb7a29fda76242998113.jpg" alt="Logo"></div>

    <div class="content">
        <h2>ğŸ›ï¸ Chuyá»ƒn Ä‘á»•i link Shopee - nháº­n mÃ£ giáº£m giÃ¡</h2>
        <p class="subtitle">MÃ£ tá»± Ä‘á»™ng cÃ³ trong má»¥c Ã¡p voucher khi mua qua link chuyá»ƒn Ä‘á»•i ^0^</p>

        <div id="inputs">
            <div class="input-row-wrapper"><div class="input-row"><span class="input-num">1</span><input type="text" class="link-input" placeholder="https://shopee.vn/..." oninput="validateLink(this)"><button class="btn-paste" onclick="pasteFromClipboard(this)">DÃ¡n ğŸ“‹</button></div><div class="status-bar warning-bar"><span>âš ï¸ Link khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng!</span><button class="auto-fix-btn" onclick="autoFix(this)">Fix link âœ¨</button></div><div class="status-bar error-bar"><span>âŒ Lá»—i: Vui lÃ²ng dÃ¹ng link Shopee chÃ­nh xÃ¡c.</span></div></div>
            <div class="input-row-wrapper"><div class="input-row"><span class="input-num">2</span><input type="text" class="link-input" placeholder="https://shopee.vn/..." oninput="validateLink(this)"><button class="btn-paste" onclick="pasteFromClipboard(this)">DÃ¡n ğŸ“‹</button></div><div class="status-bar warning-bar"><span>âš ï¸ Link khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng!</span><button class="auto-fix-btn" onclick="autoFix(this)">Fix link âœ¨</button></div><div class="status-bar error-bar"><span>âŒ Lá»—i: Vui lÃ²ng dÃ¹ng link Shopee.</span></div></div>
            <div class="input-row-wrapper"><div class="input-row"><span class="input-num">3</span><input type="text" class="link-input" placeholder="https://shopee.vn/..." oninput="validateLink(this)"><button class="btn-paste" onclick="pasteFromClipboard(this)">DÃ¡n ğŸ“‹</button></div><div class="status-bar warning-bar"><span>âš ï¸ Link khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng!</span><button class="auto-fix-btn" onclick="autoFix(this)">Fix link âœ¨</button></div><div class="status-bar error-bar"><span>âŒ Lá»—i: Vui lÃ²ng dÃ¹ng link Shopee.</span></div></div>
            <div class="input-row-wrapper"><div class="input-row"><span class="input-num">4</span><input type="text" class="link-input" placeholder="https://shopee.vn/..." oninput="validateLink(this)"><button class="btn-paste" onclick="pasteFromClipboard(this)">DÃ¡n ğŸ“‹</button></div><div class="status-bar warning-bar"><span>âš ï¸ Link khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng!</span><button class="auto-fix-btn" onclick="autoFix(this)">Fix link âœ¨</button></div><div class="status-bar error-bar"><span>âŒ Lá»—i: Vui lÃ²ng dÃ¹ng link Shopee.</span></div></div>
            <div class="input-row-wrapper"><div class="input-row"><span class="input-num">5</span><input type="text" class="link-input" placeholder="https://shopee.vn/..." oninput="validateLink(this)"><button class="btn-paste" onclick="pasteFromClipboard(this)">DÃ¡n ğŸ“‹</button></div><div class="status-bar warning-bar"><span>âš ï¸ Link khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng!</span><button class="auto-fix-btn" onclick="autoFix(this)">Fix link âœ¨</button></div><div class="status-bar error-bar"><span>âŒ Lá»—i: Vui lÃ²ng dÃ¹ng link Shopee.</span></div></div>
        </div>

        <div class="btn-group-main">
            <button class="clear-btn" onclick="clearAll()">XÃ³a háº¿t</button>
            <button id="mainBtn" class="primary-btn" onclick="generate()">Chuyá»ƒn Ä‘á»•i</button>
        </div>

        <div id="results-section" style="display:none;">
            <div class="section-label" style="font-weight:800; font-size:12px; color:var(--accent); margin:20px 0 10px 0; text-transform:uppercase;">Káº¿t quáº£ hiá»‡n táº¡i</div>
            <button id="copyAllBtn" class="copy-all-btn" onclick="copyAll()">Sao chÃ©p táº¥t cáº£ link má»›i</button>
            <div id="results"></div>
        </div>

        <button class="history-toggle" onclick="toggleHistory()">ğŸ“œ Xem lá»‹ch sá»­ chuyá»ƒn Ä‘á»•i</button>
        <div id="history-section" class="history-content"><div id="history-list"></div></div>
        <a href="https://www.instagram.com/channel/AbZaUamGAW15JNEI/" target="_blank" class="fan-btn">ğŸ’¬ Tham gia nhÃ³m bÃ¡o sale, deal</a>
        <div class="notice-board">
            <div style="font-weight:800; font-size:14px;">ğŸ“‹ Báº£ng tin voucher</div>
            <div style="font-size:11px; color:var(--accent); margin:5px 0 10px 0;">â° Ãp dá»¥ng: 1.2.2026 - 8.2.2026</div>
            <div style="font-size:13px; line-height:1.5; color:var(--text-light);">
            <br> ğŸ‘‰ğŸ» Giáº£m 25%, tá»‘i Ä‘a 250K, cho Ä‘Æ¡n tá»« 150K
            <br> ğŸ‘‰ğŸ» Giáº£m 22%, tá»‘i Ä‘a 200K, cho Ä‘Æ¡n tá»« 150K
            <br> ğŸ‘‰ğŸ» Giáº£m 20%, tá»‘i Ä‘a 100K, cho Ä‘Æ¡n tá»« 100K
            <br> ğŸ‘‰ğŸ» Giáº£m 18%, tá»‘i Ä‘a 100K, cho Ä‘Æ¡n tá»« 50K
            <br><br> â—ï¸ Duy nháº¥t 2.2: Giáº£m 30% max 300k Ä‘Æ¡n 50k</div>
        </div>
    </div>
</div>

<script>
    const AFF_ID = "17352430059";
    const BASE = "https://s.shopee.vn/an_redir?origin_link=";
    let currentBatch = [];

    async function pasteFromClipboard(btn) {
        try {
            const text = await navigator.clipboard.readText();
            const input = btn.closest('.input-row').querySelector('.link-input');
            input.value = text;
            validateLink(input); // Trigger Shopee validation immediately
        } catch (err) {
            alert("Vui lÃ²ng cho phÃ©p quyá»n truy cáº­p Clipboard Ä‘á»ƒ sá»­ dá»¥ng tÃ­nh nÄƒng nÃ y!");
        }
    }

    function validateLink(input) {
        const val = input.value.trim().toLowerCase();
        const wrapper = input.closest('.input-row-wrapper');
        const warnBar = wrapper.querySelector('.warning-bar');
        const errorBar = wrapper.querySelector('.error-bar');
        input.classList.remove('warning-link', 'error-link');
        warnBar.style.display = "none"; errorBar.style.display = "none";
        if (!val) return;
        const isShopee = val.includes('shopee.vn') || val.includes('shp.ee') || val.includes('shope.ee');
        const needsFix = (val.includes('shp.ee') || val.includes('shope.ee')) && !val.includes('shopee.vn');
        if (!isShopee) { input.classList.add('error-link'); errorBar.style.display = "flex"; } 
        else if (needsFix) { input.classList.add('warning-link'); warnBar.style.display = "flex"; }
    }

    async function autoFix(btn) {
        const wrapper = btn.closest('.input-row-wrapper');
        const input = wrapper.querySelector('.link-input');
        const originalUrl = input.value.trim();
        btn.innerText = "Äang fix..."; btn.disabled = true;
        try {
            const response = await fetch(`https://unshorten.me/s/${originalUrl}`);
            const longUrl = await response.text();
            if (longUrl && longUrl.includes('shopee.vn')) { input.value = longUrl.trim(); validateLink(input); } 
            else { window.open(originalUrl, '_blank'); }
        } catch (e) { window.open(originalUrl, '_blank'); } 
        finally { btn.innerText = "Fix link âœ¨"; btn.disabled = false; }
    }

    async function getShortLink(longUrl) {
        try {
            const response = await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(longUrl)}`);
            if (response.ok) return await response.text();
            return longUrl;
        } catch (e) { return longUrl; }
    }

    async function generate() {
        const inputs = document.querySelectorAll('.link-input');
        const display = document.getElementById('results');
        const section = document.getElementById('results-section');
        const mainBtn = document.getElementById('mainBtn');
        
        let hasError = false;
        inputs.forEach(i => { if(i.classList.contains('error-link')) hasError = true; });
        if (hasError) { alert("Sá»­a cÃ¡c link Ä‘á» trÆ°á»›c nhÃ©!"); return; }

        mainBtn.innerText = "Äang xá»­ lÃ½..."; mainBtn.disabled = true;
        display.innerHTML = ""; currentBatch = [];
        let history = JSON.parse(localStorage.getItem('sh_hist') || "[]");

        for (let i = 0; i < inputs.length; i++) {
            const val = inputs[i].value.trim();
            if (val) {
                const longAff = BASE + encodeURIComponent(val) + "&affiliate_id=" + AFF_ID;
                const final = await getShortLink(longAff);
                
                currentBatch.push(final);
                const card = document.createElement('div');
                card.className = 'result-card';
                card.innerHTML = `<div style="font-weight:800; font-size:11px; color:var(--accent); margin-bottom:5px;">LINK #${i+1}</div>
                    <div style="font-size:11px; word-break:break-all; margin-bottom:10px;">${final}</div>
                    <div class="btn-row"><a href="${final}" target="_blank" class="btn-purchase">Mua ngay</a><button class="btn-copy" onclick="copySingle('${final}')">Sao chÃ©p</button></div>`;
                display.appendChild(card);
                history.unshift({ url: final, time: new Date().toLocaleTimeString('vi-VN') });
            }
        }

        if (currentBatch.length > 0) {
            section.style.display = "block";
            document.getElementById('copyAllBtn').style.display = "block";
            localStorage.setItem('sh_hist', JSON.stringify(history.slice(0, 15)));
            loadHistory();
        }
        mainBtn.innerText = "Chuyá»ƒn Ä‘á»•i"; mainBtn.disabled = false;
    }

    function copySingle(txt) { navigator.clipboard.writeText(txt).then(() => alert("ÄÃ£ sao chÃ©p!")); }
    function copyAll() { navigator.clipboard.writeText(currentBatch.join('\n')).then(() => alert("ÄÃ£ sao chÃ©p táº¥t cáº£!")); }
    function clearAll() { document.querySelectorAll('.link-input').forEach(i => { i.value = ""; i.classList.remove('warning-link', 'error-link'); }); document.querySelectorAll('.status-bar').forEach(b => b.style.display="none"); document.getElementById('results-section').style.display="none"; }
    function toggleHistory() { const s = document.getElementById('history-section'); s.style.display = s.style.display === "block" ? "none" : "block"; }
    function loadHistory() {
        const list = document.getElementById('history-list');
        const hist = JSON.parse(localStorage.getItem('sh_hist') || "[]");
        list.innerHTML = hist.length ? "" : "<p style='font-size:11px; text-align:center;'>Trá»‘ng</p>";
        hist.forEach(h => {
            const d = document.createElement('div'); d.className = 'result-card'; d.style.opacity = "0.75";
            d.innerHTML = `<div style="font-size:10px; font-weight:bold; color:var(--accent); margin-bottom:5px;">LÃºc ${h.time}</div><div style="font-size:10px; word-break:break-all;">${h.url}</div>`;
            list.appendChild(d);
        });
    }
    window.onload = loadHistory;
</script>

</body>
</html>
